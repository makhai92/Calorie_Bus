<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>운동정보</title>
<style>
	.content>.view-tbl tr>*{
		font-size : 18px;
	}
	.view-tbl tr>td>span{
		font-size : 18px;
	}
	.wrap{
		overflow: hidden;
	}
	.wrap>div{
		height: 80px;
		line-height: 80px;
		padding : 0px 20px;
	}
	.wrap>.like-wrap>span{
		line-height:80px;
		cursor: pointer;
		font-size: 36px;
	}
	.update-btn-wrap{
		float:left;
	}
	.wrap>.like-wrap{
		float:right;
	}
	.favorite{
		color:var(--point1);		
	}
	.notFavorite{
		color:var(--point1);
	}
	.view-tbl #content-box>td{
		text-align: left;
		min-height: 500px;
	}
</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<main class="content">
		<div class="page-title">운동정보</div>
		<table class="tbl view-tbl">
			<tr>
				<th colspan="6" th:text=${exercise.boardTitle}></th>
			</tr>
			<tr>
				<th>작성자</th>
				<td style="width:50%; text-align: left;" th:text=${exercise.boardWriter}>아이디</td>
				<td>조회수 : <span th:text=${exercise.readCount}></span></td>
				<td>좋아요수 : <span th:text=${exercise.likeCount}></span></td>
				<td>작성일 : <span th:text=${exercise.regDate}></span>
			</tr>
			<tr>
				<th colspan="1">첨부파일</th>
				<td colspan="4" style="text-align: left;">
					<th:block th:each="file : ${exercise.fileList}">
						<a th:href="@{/exercise/filedown(filename=${file.filename},filepath=${file.filepath})}">
							<span class="material-icons">description</span>
							<span  th:text="${file.filename}"></span>
						</a>
					</th:block>
				</td>
			<tr>
			<tr id="content-box">
				<td colspan="5" th:utext=${exercise.boardContent}></td>
			</tr>
		</table>
		<div class="wrap">
			<div class="update-btn-wrap">
				<a class="btn-round" href="/exercise/updateFrm">수정하기</a>
				<a class="btn-round g">삭제하기</a>
			</div>
				<form action="/exercise/insertExerciseComment" method="post">
				<div th:if="${session.member} != null" class="input-item1 input-comment-box">
					<span class="material-icons">person</span>
					<span th:text=${session.member.memberId}></span>
					<textarea name="boardCommentContent" style="resize:none;"></textarea>
					<button type="submit" class="btn-square" style="height:50px">댓글작성</button>
					<input type="hidden" name="boardRef" th:value="${exercise.boardNo}">
				</div>
			</form>
		<span>댓글수 : <span th:text="${exercise.commentCount}"></span></span>
		<div class="comment-wrap">
			<ul th:each="ec : ${exercise.boardCommentList}">
				<li>
					<p class="comment-info">
						<span class="material-icons">person</span>
						<span th:text="${ec.boardCommentWriter}"></span>
						작성일 : <span th:text="${ec.boardCommentDate}"></span>
						좋아요수 : <span th:text="${ec.likeCount}"></span>
						<span th:if="${ec.isLike}==1" class="material-icons favorite" th:onclick="likePush(this,[[${ec.boardCommentNo}]]);">thumb_down</span>
						<span th:if="${ec.isLike}==0" class="material-icons notFavorite" th:onclick="likePush(this,[[${ec.boardCommentNo}]]);">thumb_up</span>
						<a th:if="${session.member != null && session.member.memberNo == ec.memberNo}" href="javascript:void(0)" class="updateComment">수정</a>
						<a th:if="${session.member != null && session.member.memberNo == ec.memberNo}" href="javascript:void(0)" class="deleteComment">삭제</a>
					</p>
					<p th:text="${ec.boardCommentContent}"></p>
					<div class="reComment-box">
						<span th:text="'답글수 ' +${ec.reCommentCount}"></span>
						<div>
							<a th:if="${ec.reCommentCount > 0}" href="javascript:void(0)" th:onclick="commentShow(this,[[${ec.boardCommentNo}]]);">답글보기</a>
							<a href="javascript:void(0)" class="recShow">답글달기</a>
						</div>
					</div>
				</li>
				<li>
					<form action="/exercise/insertBoardComment" method="post">
						<div th:if="${session.member} != null" class="input-item1 input-comment-box" style="display:none;">
							<span class="material-icons">person</span>
							<span th:text=${session.member.memberId}></span>
							<textarea name="boardCommentContent" style="resize:none;"></textarea>
							<button type="submit" class="btn-square" style="height:50px">댓글작성</button>
							<input type="hidden" name="boardRef" th:value="${exercise.boardNo}">
							<input type="hidden" name="boardCommentRef" th:value="${ec.boardCommentNo}">
						</div>
					</form>
				</li>
			</ul>
		</div>
	</main>
	<script>
		const boardNo = "[[${exercise.boardNo}]]";
		$(".like-wrap>span").on("click",function(){
			const likeSpan = $(this);
			const isLike = likeSpan.hasClass("favorite")?1:0;
			$.ajax({
				url : "/exercise/exerciseLikePush",
				data : {boardNo : boardNo, isLike : isLike},
				type : "post",
				success : function(data){
					if(data == -1){
						console.log("처리오류");
					}else if(data == -10){
						alert("로그인을 하세요.");							
					}else{
						if(isLike === 1){
							likeSpan.removeClass("favorite");		
							likeSpan.addClass("notFavorite");
							likeSpan.text("thumb_up");
						}else{
							likeSpan.removeClass("notFavorite");
							likeSpan.addClass("favorite");
							likeSpan.text("thumb_down");
						}
						$(".view-tbl tr>td>span").eq(1).text(data);
					}
				},
				error : function(){
					console.log("error")
				}
			});
		});
		function likePush(obj, boardCommentNo){
			const likeSpan = $(obj);
			const isLike = likeSpan.hasClass("favorite")?1:0;
			$.ajax({
				url : "/exercise/exerciseCommentLikePush",
				data : {boardCommentNo : boardCommentNo, isLike : isLike},
				type : "post",
				success : function(data){
					if(data == -1){
						console.log("처리오류");
					}else if(data == -10){
						alert("로그인해라");							
					}else{
						if(isLike === 1){
							likeSpan.removeClass("favorite");		
							likeSpan.addClass("notFavorite");
							likeSpan.text("thumb_up");
						}else{
							likeSpan.removeClass("notFavorite");
							likeSpan.addClass("favorite");
							likeSpan.text("thumb_down");
						}
						$(obj).prev().text(data);
					}
				},
				error : function(){
					console.log("error");
				}
			});
		};
		$(".recShow").on("click",function(){
			const index = $(".recShow").index(this);
			if($(this).text() === "답글달기"){
				$(this).text("취소");
			}else{
				$(this).text("답글달기");
			}
			$(".input-comment-box").eq(index+1).toggle();
		});
		function commentShow(obj, boardCommentNo){
			$.ajax({
				url : "/exercise/exercisereCommentList",
				data : {boardCommentNo : boardCommentNo},
				type : "post",
				success : function(data){
					for(let i=0;i<data.length;i++){
						const bc = data[i];
						const ul = $("<ul>");
						const li1 = $("<li>");
						const commentInfoP = $("<p class='comment-info'>");
						const IconSpan = $("<span class='material-icons'>");
						IconSpan.text("person");
					}
				},
				error : function(){
					console.log("error");	
				}
			});
		}
	</script>
	<th:block th:include="common/footer"></th:block>
</body>
</html>